{% comment %}
  Layout simplificado de colección full width
  - Sin sidebar
  - Sin overlays
  - Nuevo sistema de filtros (4 dropdowns horizontales)
  - Grid 4 columnas desktop, 2 tablet, 1-2 móvil
  - Paginación centrada
{% endcomment %}

<section class="collection-page-fullwidth">
  <div class="content-page">
    <div class="container container-v1">
      
      {% comment %} Nuevo sistema de filtros simplificados {% endcomment %}
      {% include 'collection-filters-simple' %}
      
      {% comment %} Grid de productos: 4 columnas desktop, 2 tablet, 1-2 móvil {% endcomment %}
      <div class="row">
        <div class="col-lg-12">
          <div class="clearfix relative collection_prod">  
            {% if section.settings.prod_layout == 'prod_grid' %}
            <div class="product-grid-view grid-uniform">
              <div class="row" id="products-container">
                {% for product in collection.products %}
                {% comment %} Extraer información del producto para filtrado {% endcomment %}
                {% assign product_colors_string = '' %}
                {% assign product_colors_array = '' | split: ',' %}
                {% assign product_sizes_string = '' %}
                {% assign product_sizes_array = '' | split: ',' %}
                {% assign color_option_index = -1 %}
                
                {% comment %} Buscar opción de color {% endcomment %}
                {% for option in product.options %}
                  {% assign option_lower = option | downcase | strip %}
                  {% if option_lower == 'color' or option_lower == 'colour' or option_lower contains 'color' %}
                    {% assign color_option_index = forloop.index0 %}
                    {% break %}
                  {% endif %}
                {% endfor %}
                
                {% comment %} Recopilar colores y tallas del producto {% endcomment %}
                {% for variant in product.variants %}
                  {% if color_option_index >= 0 %}
                    {% assign color_name = '' %}
                    {% if color_option_index == 0 and variant.option1 != blank %}
                      {% assign color_name = variant.option1 | strip %}
                    {% elsif color_option_index == 1 and variant.option2 != blank %}
                      {% assign color_name = variant.option2 | strip %}
                    {% elsif color_option_index == 2 and variant.option3 != blank %}
                      {% assign color_name = variant.option3 | strip %}
                    {% endif %}
                    
                    {% if color_name != blank %}
                      {% assign color_handle = color_name | handleize %}
                      {% assign color_check = '|' | append: color_handle | append: '|' %}
                      {% unless product_colors_string contains color_check %}
                        {% assign product_colors_string = product_colors_string | append: color_check %}
                        {% assign product_colors_array = product_colors_array | push: color_handle %}
                      {% endunless %}
                    {% endif %}
                  {% endif %}
                  
                  {% comment %} Recopilar tallas desde metafield de variantes {% endcomment %}
                  {% if variant.metafields.custom.talla_estandar != blank %}
                    {% assign size_value = variant.metafields.custom.talla_estandar | strip %}
                    {% if size_value != blank %}
                      {% assign size_handle = size_value | handleize %}
                      {% assign size_check = '|' | append: size_handle | append: '|' %}
                      {% unless product_sizes_string contains size_check %}
                        {% assign product_sizes_string = product_sizes_string | append: size_check %}
                        {% assign product_sizes_array = product_sizes_array | push: size_handle %}
                      {% endunless %}
                    {% endif %}
                  {% endif %}
                {% endfor %}
                
                {% comment %} Fallback: leer talla desde producto si no se encontró en variantes {% endcomment %}
                {% if product_sizes_array.size == 0 and product.metafields.custom.talla_estandar != blank %}
                  {% assign size_value = product.metafields.custom.talla_estandar | strip %}
                  {% if size_value != blank %}
                    {% assign size_handle = size_value | handleize %}
                    {% assign size_check = '|' | append: size_handle | append: '|' %}
                    {% unless product_sizes_string contains size_check %}
                      {% assign product_sizes_string = product_sizes_string | append: size_check %}
                      {% assign product_sizes_array = product_sizes_array | push: size_handle %}
                    {% endunless %}
                  {% endif %}
                {% endif %}
                
                {% comment %} Obtener precio mínimo del producto (en centavos, convertir a unidades) {% endcomment %}
                {% assign product_min_price = product.price_min | divided_by: 100.0 | times: 1 %}
                
                <div class="col-lg-3 col-md-6 col-6 pb-4 trans-product product-item-wrapper" 
                     data-product-colors="{{ product_colors_array | join: ',' }}"
                     data-product-sizes="{{ product_sizes_array | join: ',' }}"
                     data-product-price="{{ product_min_price }}"
                     data-product-id="{{ product.id }}">
                  {% include 'product-item-v1' %}
                </div>
                {% else %}
                {% if collection.handle == 'all' and current_tags == '' %}
                {% for i in (1..16) %}
                <div class="col-lg-3 col-md-6 col-6">
                  {% include 'empty-product-item' %}
                </div>
                {% endfor %}
                {% else %}
                {% comment %}
                If collection exists but is empty, display message
                {% endcomment %}
                <div class="col-12 text-center">
                  <p>{{ 'collections.general.no_matches' | t }}</p>
                </div>
                {% endif %}
                {% endfor %}
              </div>

              {% comment %} Paginación centrada y corregida {% endcomment %}
              {% if paginate.pages > 1 %}
              <div class="pagi-nav text-center">
                {{ paginate | default_pagination | replace: '&laquo; Previous', '<i class="fa fa-angle-left"></i>' | replace: 'Next &raquo;', 'Siguiente' | replace: '&raquo;', '' | replace: 'Siguiente »', 'Siguiente' | replace: '»', '' | replace: '&nbsp;»', '' | replace: '&nbsp;&raquo;', '' }}
              </div>
              {% endif %}
            </div>
            {% elsif section.settings.prod_layout == 'prod_list' %}
            <div class="product-list-view grid-uniform">
              {% for product in collection.products %}
              <div class="list_prod">
                {% include 'product-item-list' %}
              </div>
              {% else %}
              {% if collection.handle == 'all' and current_tags == '' %}
              {% for i in (1..16) %}
              <div class="col-lg-3">
                {% include 'empty-product-item' %}
              </div>
              {% endfor %}
              {% else %}
              <div class="text-center">
                <p>{{ 'collections.general.no_matches' | t }}</p>
              </div>
              {% endif %}
              {% endfor %}
              {% if paginate.pages > 1 %}
              <div class="pagi-nav text-center pt-4">
                {{ paginate | default_pagination | replace: '&laquo; Previous', '<i class="fa fa-angle-left"></i>' | replace: 'Next &raquo;', 'Siguiente' | replace: '&raquo;', '' | replace: 'Siguiente »', 'Siguiente' | replace: '»', '' | replace: '&nbsp;»', '' | replace: '&nbsp;&raquo;', '' }}
              </div>
              {% endif %}
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Estilos para paginación corregida */
  .pagi-nav {
    margin: 40px auto;
    padding: 0;
    width: 100%;
    max-width: 100%;
    overflow: visible;
    text-align: center;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  .pagi-nav .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    list-style: none;
    padding: 0;
    margin: 0 auto;
    gap: 8px;
    width: auto;
    max-width: 100%;
  }
  
  .pagi-nav .pagination li {
    margin: 0;
    padding: 0;
    display: inline-block;
    vertical-align: middle;
  }
  
  .pagi-nav .pagination a,
  .pagi-nav .pagination span {
    display: inline-block;
    padding: 10px 14px;
    margin: 0;
    border: 1px solid #ddd;
    background: #fff;
    color: #000;
    text-decoration: none;
    min-width: 44px;
    height: 44px;
    line-height: 24px;
    text-align: center;
    box-sizing: border-box;
    transition: all 0.3s ease;
    vertical-align: middle;
  }
  
  .pagi-nav .pagination a:hover {
    background: #000;
    color: #fff;
    border-color: #000;
  }
  
  .pagi-nav .pagination .current {
    background: #000;
    color: #fff;
    border-color: #000;
  }
  
  /* Sobrescribir estilos del tema para prev/next - Selectores más específicos */
  .pagi-nav .pagination > span.prev,
  .pagi-nav .pagination > span.next,
  .pagi-nav .pagination span.prev,
  .pagi-nav .pagination span.next,
  .pagi-nav .pagination .prev,
  .pagi-nav .pagination .next,
  .pagi-nav .pagination li.prev,
  .pagi-nav .pagination li.next {
    background: #fff !important;
    border: 1px solid #ddd !important;
    padding: 10px 16px !important;
    min-width: 90px !important;
    width: auto !important;
    max-width: none !important;
    height: 44px !important;
    box-sizing: border-box !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    position: relative !important;
    left: auto !important;
    right: auto !important;
    top: auto !important;
    bottom: auto !important;
    margin: 0 !important;
    line-height: 1 !important;
    font-size: 14px !important;
    z-index: 1 !important;
    border-left: 1px solid #ddd !important;
    border-right: 1px solid #ddd !important;
    float: none !important;
    white-space: nowrap !important;
    overflow: hidden !important;
  }
  
  /* Sobrescribir específicamente el selector del tema .pagination>span.next */
  .pagi-nav .pagination > span.next,
  .pagi-nav .pagination > span.prev,
  .pagi-nav .pagination li > span.next,
  .pagi-nav .pagination li > span.prev {
    position: relative !important;
    left: auto !important;
    right: auto !important;
    top: auto !important;
    bottom: auto !important;
    height: 44px !important;
    line-height: 1 !important;
    min-width: 90px !important;
    padding: 10px 16px !important;
    display: inline-flex !important;
    width: auto !important;
    max-width: none !important;
  }
  
  .pagi-nav .pagination > span.prev a,
  .pagi-nav .pagination > span.next a,
  .pagi-nav .pagination span.prev a,
  .pagi-nav .pagination span.next a,
  .pagi-nav .pagination .prev a,
  .pagi-nav .pagination .next a,
  .pagi-nav .pagination li.prev a,
  .pagi-nav .pagination li.next a {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 100% !important;
    height: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
    border: none !important;
    background: transparent !important;
    color: #000 !important;
    text-decoration: none !important;
    white-space: nowrap !important;
    min-width: auto !important;
    line-height: 1 !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }
  
  .pagi-nav .pagination span.prev:hover,
  .pagi-nav .pagination span.next:hover,
  .pagi-nav .pagination .prev:hover,
  .pagi-nav .pagination .next:hover {
    background: #000 !important;
    border-color: #000 !important;
  }
  
  .pagi-nav .pagination span.prev:hover a,
  .pagi-nav .pagination span.next:hover a,
  .pagi-nav .pagination .prev:hover a,
  .pagi-nav .pagination .next:hover a {
    color: #fff !important;
  }
  
  .pagi-nav .pagination span.prev i,
  .pagi-nav .pagination span.next i,
  .pagi-nav .pagination .prev i,
  .pagi-nav .pagination .next i {
    font-size: 16px !important;
    line-height: 1 !important;
    margin: 0 4px !important;
    display: inline-block !important;
    vertical-align: middle !important;
  }
  
  /* Responsive - Tablet */
  @media (max-width: 991px) and (min-width: 576px) {
    .pagi-nav .pagination {
      gap: 6px;
    }
    
    .pagi-nav .pagination a,
    .pagi-nav .pagination span {
      padding: 9px 12px;
      min-width: 40px;
      height: 40px;
      font-size: 14px;
    }
    
    .pagi-nav .pagination > span.prev,
    .pagi-nav .pagination > span.next,
    .pagi-nav .pagination span.prev,
    .pagi-nav .pagination span.next,
    .pagi-nav .pagination .prev,
    .pagi-nav .pagination .next,
    .pagi-nav .pagination li.prev,
    .pagi-nav .pagination li.next {
      padding: 9px 14px !important;
      min-width: 85px !important;
      width: auto !important;
      max-width: none !important;
      height: 40px !important;
      box-sizing: border-box !important;
      font-size: 14px !important;
      position: relative !important;
      left: auto !important;
      right: auto !important;
      top: auto !important;
      bottom: auto !important;
      margin: 0 !important;
      line-height: 1 !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      z-index: 1 !important;
      border-left: 1px solid #ddd !important;
      border-right: 1px solid #ddd !important;
      float: none !important;
    }
    
    .pagi-nav .pagination span.prev a,
    .pagi-nav .pagination span.next a,
    .pagi-nav .pagination .prev a,
    .pagi-nav .pagination .next a {
      font-size: 14px !important;
      white-space: nowrap !important;
      width: 100% !important;
      height: 100% !important;
      line-height: 1 !important;
      box-sizing: border-box !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
    }
  }
  
  /* Responsive - Mobile */
  @media (max-width: 575px) {
    .pagi-nav {
      margin: 30px auto;
      padding: 0 10px;
    }
    
    .pagi-nav .pagination {
      gap: 4px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .pagi-nav .pagination li {
      margin: 2px;
    }
    
    .pagi-nav .pagination a,
    .pagi-nav .pagination span {
      padding: 8px 10px;
      min-width: 36px;
      height: 36px;
      font-size: 13px;
      line-height: 20px;
    }
    
    .pagi-nav .pagination > span.prev,
    .pagi-nav .pagination > span.next,
    .pagi-nav .pagination span.prev,
    .pagi-nav .pagination span.next,
    .pagi-nav .pagination .prev,
    .pagi-nav .pagination .next,
    .pagi-nav .pagination li.prev,
    .pagi-nav .pagination li.next {
      padding: 8px 12px !important;
      min-width: 80px !important;
      width: auto !important;
      max-width: none !important;
      height: 36px !important;
      box-sizing: border-box !important;
      font-size: 13px !important;
      position: relative !important;
      left: auto !important;
      right: auto !important;
      top: auto !important;
      bottom: auto !important;
      margin: 2px !important;
      line-height: 1 !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
      z-index: 1 !important;
      border-left: 1px solid #ddd !important;
      border-right: 1px solid #ddd !important;
      float: none !important;
      white-space: nowrap !important;
      overflow: hidden !important;
    }
    
    .pagi-nav .pagination span.prev a,
    .pagi-nav .pagination span.next a,
    .pagi-nav .pagination .prev a,
    .pagi-nav .pagination .next a {
      font-size: 13px !important;
      white-space: nowrap !important;
      padding: 0 !important;
      width: 100% !important;
      height: 100% !important;
      line-height: 1 !important;
      box-sizing: border-box !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
    }
    
    .pagi-nav .pagination span.prev i,
    .pagi-nav .pagination span.next i,
    .pagi-nav .pagination .prev i,
    .pagi-nav .pagination .next i {
      font-size: 14px !important;
      margin: 0 3px !important;
      display: inline-block !important;
      vertical-align: middle !important;
      line-height: 1 !important;
    }
  }
</style>
