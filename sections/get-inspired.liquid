<section class="get-inspired" data-section-id="{{ section.id }}" data-section-type="get-inspired">
  {% if section.settings.title != blank %}
    <h2 class="get-inspired-title">{{ section.settings.title }}</h2>
  {% endif %}
  
  {% if section.blocks.size > 0 %}
    <!-- Grid para Desktop y Tablet -->
    <div class="get-inspired-grid">
      {% for block in section.blocks %}
        <div class="inspired-item" {{ block.shopify_attributes }}>
          {% assign image_url = block.settings.image_url | default: blank %}
          {% if image_url == blank and block.settings.image != blank %}
            {% assign image_url = block.settings.image | img_url: 'master' %}
          {% endif %}
          
          {% if image_url != blank %}
            {% if block.settings.link_url != blank %}
              <a href="{{ block.settings.link_url }}" class="inspired-link">
                <img 
                  src="{{ image_url }}" 
                  alt="{{ block.settings.alt_text | default: block.settings.image.alt | escape }}"
                  loading="lazy"
                >
              </a>
            {% else %}
              <img 
                src="{{ image_url }}" 
                alt="{{ block.settings.alt_text | default: block.settings.image.alt | escape }}"
                loading="lazy"
              >
            {% endif %}
          {% else %}
            <div class="inspired-placeholder">
              <p>Agrega una imagen en este bloque</p>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <!-- Carrusel para todos los tamaños -->
    <div class="get-inspired-carousel" id="get-inspired-carousel-{{ section.id }}">
      {% for block in section.blocks %}
        <div class="inspired-item" {{ block.shopify_attributes }}>
          {% assign image_url = block.settings.image_url | default: blank %}
          {% if image_url == blank and block.settings.image != blank %}
            {% assign image_url = block.settings.image | img_url: 'master' %}
          {% endif %}
          
          {% if image_url != blank %}
            {% if block.settings.link_url != blank %}
              <a href="{{ block.settings.link_url }}" class="inspired-link">
                <img 
                  src="{{ image_url }}" 
                  alt="{{ block.settings.alt_text | default: block.settings.image.alt | escape }}"
                  loading="lazy"
                >
              </a>
            {% else %}
              <img 
                src="{{ image_url }}" 
                alt="{{ block.settings.alt_text | default: block.settings.image.alt | escape }}"
                loading="lazy"
              >
            {% endif %}
          {% else %}
            <div class="inspired-placeholder">
              <p>Agrega una imagen en este bloque</p>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="get-inspired-empty">
      <p>Agrega bloques de imagen desde el editor para mostrar contenido aquí.</p>
    </div>
  {% endif %}
</section>

<script>
  (function() {
    var sectionId = '{{ section.id }}';
    var carouselInitialized = false;
    
    function initGetInspiredCarousel() {
      var carousel = document.getElementById('get-inspired-carousel-' + sectionId);
      
      if (!carousel) return;
      
      // Esperar a que jQuery y Slick estén disponibles
      if (typeof jQuery === 'undefined' || !jQuery.fn.slick) {
        setTimeout(initGetInspiredCarousel, 100);
        return;
      }
      
      var $carousel = jQuery(carousel);
      
      // Función para inicializar carrusel en todos los tamaños de pantalla
      function handleCarousel() {
        var windowWidth = window.innerWidth;
        var slidesToShow = 1;
        
        // Determinar cuántas slides mostrar según el tamaño de pantalla
        if (windowWidth >= 1200) {
          // Desktop grande: mostrar 3 slides
          slidesToShow = 3;
        } else if (windowWidth >= 768) {
          // Tablet: mostrar 2 slides
          slidesToShow = 2;
        } else {
          // Mobile: mostrar 1 slide
          slidesToShow = 1;
        }
        
        // Inicializar carrusel si no está inicializado
        if (!$carousel.hasClass('slick-initialized')) {
          $carousel.slick({
            dots: true,
            arrows: true,
            infinite: true,
            speed: 500,
            slidesToShow: slidesToShow,
            slidesToScroll: 1,
            adaptiveHeight: false,
            autoplay: false,
            fade: false,
            cssEase: 'ease-in-out',
            swipe: true,
            touchMove: true,
            draggable: true,
            touchThreshold: 5,
            centerMode: false,
            variableWidth: false,
            responsive: [
              {
                breakpoint: 1200,
                settings: {
                  slidesToShow: 2,
                  slidesToScroll: 1,
                  infinite: true,
                  dots: true,
                  arrows: true
                }
              },
              {
                breakpoint: 768,
                settings: {
                  slidesToShow: 1,
                  slidesToScroll: 1,
                  infinite: true,
                  dots: true,
                  arrows: true
                }
              }
            ]
          });
          
          carouselInitialized = true;
        } else {
          // Si ya está inicializado, actualizar la configuración
          $carousel.slick('slickSetOption', 'slidesToShow', slidesToShow, true);
        }
      }
      
      // Inicializar al cargar
      function init() {
        // Esperar un poco más para asegurar que todo esté listo
        setTimeout(function() {
          handleCarousel();
        }, 300);
      }
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
      
      // Manejar redimensionamiento
      var resizeTimer;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
          handleCarousel();
        }, 300);
      });
    }
    
    // Iniciar
    initGetInspiredCarousel();
  })();
</script>

{% schema %}
{
  "name": "Get Inspired",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Título",
      "default": "GET INSPIRED"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Imagen",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Imagen"
        },
        {
          "type": "text",
          "id": "image_url",
          "label": "URL de imagen externa",
          "info": "Opcional: Si se proporciona, se usará esta URL en lugar de la imagen subida"
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Texto alternativo",
          "info": "Si se deja vacío, se usará el texto alternativo de la imagen"
        },
        {
          "type": "url",
          "id": "link_url",
          "label": "URL del enlace",
          "info": "Opcional: Agrega una URL para que la imagen sea clickeable (producto, colección, página, etc.)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Get Inspired",
      "category": "Homepage",
      "blocks": [
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        }
      ]
    }
  ]
}
{% endschema %}

